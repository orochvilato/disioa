{{ extend "base.html" }}
{{ block title }}Les députés | Observatoire Insoumis{{ end }}
{{ block content }}
<div id="deputes-template" class="container">
    <div id="deputes-search">
      <label for="search"><i class="fa fa-search" aria-hidden="true"></i></label>
      <input id="deputes-searchtext" name="txt" placeholder="Rechercher ..." value="{{=params.get('text','')}}">
    </div>
    <div class="deputes-filters">
        <select id="deputes-top-filter" name="top">{{ for k,v in tops: }}<option value="{{=k}}" {{ if params.get('top','top')==k:}}selected{{pass}}>{{=v}}</option>{{ pass }}</select>
        <select id="deputes-sort" name="tri">{{ for k,v in tris.iteritems(): }}<option value="{{=k}}" {{ if params.get('tri','stats.positions.exprimes')==k:}}selected{{pass}}>{{=v['label']}}</option>{{ pass }}</select>
        <select id="deputes-groupe-filter" name="gp">{{ for id,lib in [('ALL','Tous les groupes')]+groupes: }}<option value="{{ =id }}" {{ if params.get('groupe','ALL')==id:}}selected{{pass}}>{{ =lib }}</option>{{ pass }}</select>
        <select id="deputes-region-filter" name="rg">{{ for r in ['Toutes les régions']+regions: }}<option value="{{ =r }}" {{ if params.get('region','ALL')==r:}}selected{{pass}}>{{ =r }}</option>{{ pass }}</select>
    </div>
    <div id="deputes-liste">

    </div>
{{ end }}
{{ block script }}
    <script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
    <script src="https://unpkg.com/infinite-scroll@3/dist/infinite-scroll.pkgd.min.js"></script>
    <script src="{{=URL('static','js/deputes2.js')}}"></script>
    <script>
        {{ import json }}
        var params = JSON.parse('{{ =XML(json.dumps(params)) }}');
         // Votes

        var top_IS;
        function go_IS() {
          
          if (top_IS) {
              top_IS.element.innerHTML = "";
              top_IS.destroy();
              console.log('destroy');
          }
          return setInfiniteScroll(id='deputes-liste',path='{{=URL("deputes","ajax_tops")}}',args=params,append='.depute-item',urlappend=true);
        }
        top_IS = go_IS();
    </script>
{{ end }}
